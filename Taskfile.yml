version: '3'

tasks:
  setup:
    desc: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    cmds:
      - echo "üß∞ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
      - echo "üì¶ –û–±–Ω–æ–≤–ª—è—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Go (go mod tidy)..."
      - go mod tidy
      - cp .env.example .env
      - |
        echo -n "‚û°Ô∏è –í–≤–µ–¥–∏—Ç–µ Telegram —Ç–æ–∫–µ–Ω: "
        read TOKEN
        sed -i.bak "s|^TELEGRAM_TOKEN=.*|TELEGRAM_TOKEN=$$TOKEN|" .env
        rm -f .env.bak
      - echo "‚úÖ –ì–æ—Ç–æ–≤–æ. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å: task run"

  run:
    desc: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ Docker
    cmds:
      - echo "üß™ –ó–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç—ã..."
      - go test ./...
      - echo "üê≥ –ó–∞–ø—É—Å–∫–∞—é Docker..."
      - docker compose up --build
